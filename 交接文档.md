### 交接文档（Eastern-Firefighter / EF-webapp + 前端）

- 更新时间：2025-10-09
- 负责人交接对象：后端开发、前端开发、测试、运维

---

### 1. 项目概述
- 后端：Spring Boot 3.5、Java 17、Maven 多模块，核心运行模块为 `EF-webapp`（聚合 Web 应用，依赖各业务子模块）。
- 前端：Vue 3 + Vite + Vue Router + Pinia，电商类“淘宝风”界面，保留消防主题。
- 数据库与中间件：MySQL、Redis、Flyway（数据库版本管理）。

---

### 2. 环境与账号
- 开发机：Windows 10（PowerShell）
- JDK：17（路径示例 `D:\jdk17`）
- Maven：本地仓库示例 `D:\maven-repository`
- Node.js：建议 LTS（≥ 18），配合 pnpm 或 npm
- 数据库：MySQL 8.x（本地或测试库，需手动确认）
- Redis：本地或远端，按 `application-private.yml` 配置

账号配置（请填真实值，勿提交到 Git）：
- MySQL：`spring.datasource.url`、`username`、`password`
- Redis：`spring.data.redis.host`、`port`、`password`

---

### 3. 代码与目录结构（关键模块）
- 根目录：`D:\Eastern-Firefighter\Eastern-Firefighter`
  - 后端聚合模块：`EF-webapp`（运行入口，依赖 `EF-core`、`EF-ai`、`EF-auth`、`EF-commerce`、`EF-merchant`、`EF-user`、`EF-content`、`EF-sync`、`EF-museum`、`EF-training`）
  - 前端：`frontend`
- 应用入口类：`EF-webapp/src/main/java/com/easternfirefighter/EasternFirefighterApplication.java`
- 全局配置（示例）：`application.yml`、`application-private.yml`（当前激活 profile 为 `private`）
- Flyway：默认扫描 `classpath:db/migration`（注意有历史文件被删除，见“已知风险”）

---

### 4. 构建与运行（关键命令）
后端（建议先全量编译一次，确保依赖模块安装到本地仓库）：
```powershell
# 根目录一次性安装所有子模块（跳过测试）
mvn -q -DskipTests clean install

# 进入 EF-webapp 打包或直接运行
cd EF-webapp
mvn -q -DskipTests clean package
mvn spring-boot:run
# 或使用 IDE 运行
```
健康检查：
```bash
GET http://localhost:8080/actuator/health
```

前端：
```powershell
cd frontend
npm install
npm run dev -- --host
# 如遇 HMR/缓存异常，可删除 frontend/node_modules/.vite 后再启动
```

---

### 5. 配置要点
- 激活的 Spring Profile：`private`
- MySQL 驱动：已在 `EF-webapp/pom.xml` 新增
  - 依赖：`com.mysql:mysql-connector-j`（scope: runtime）
- 数据源配置位于 `application-private.yml`（请确认 URL、账号、密码）
- Flyway：如暂无迁移脚本，请确保禁用或补齐，否则会在启动阶段初始化数据源时报错

---

### 6. 近期重要变更（已完成）
- 后端
  - `EF-webapp/pom.xml`：新增 `mysql-connector-j` 以修复 “Failed to load driver class com.mysql.cj.jdbc.Driver”。
  - `AuthInterceptor.java`：移除对 `MerchantInfo`、`MerchantInfoMapper` 的引用，解决编译失败。
  - `WebMvcConfig.java`：注册拦截器时增加空指针保护，避免因调整拦截器导致的装配失败。
- 前端
  - `Home.vue`：多次修复 SFC 结构错误；重构为“淘宝风”且紧凑布局；轮播缩小并靠右，文字在左；商品卡 5 列（1024px=4列，768px=2列）。
  - `NavBar.vue`：使用 `logo.svg` 替换“东方灭火侠”文字；导航项改为圆角“筹码”风格；头像移到最右并 48px 圆形。
  - `Profile.vue`：新增加载/错误态；酷炫风红色渐变头图；垂直卡片排布；表单与密码设置分卡片；响应式优化。
  - `theme.css`：恢复与增强全局变量、卡片/按钮规范、商品栅格、页头/页脚样式；修复多次被清空/语法错误的问题。
  - 路由 `router/index.ts`：确保默认导出 `export default router`，修复动态导入失败。

---

### 7. 当前状态与待办
- 后端启动错误已定位为缺少 MySQL 驱动，并已补齐依赖。需重新编译运行验证。
- 前端主要页面已恢复并样式优化，但建议全量自测：
  - 商品列表/详情接口联调与兜底逻辑
  - 登录（短信登录 500）后端接口检查
  - 页脚/页头在不同分辨率下的对齐与两行内展示要求
  - 主题变量在浅/深色背景下的可读性

建议的待办清单：
- 修复 `api/auth/sms/login` 500（检查后端路由、服务实现、DB 表结构/初始数据、限流/缓存依赖）。
- 为 `ProductDetail.vue`、`Profile.vue` 增加接口契约文档与类型校验。
- 完成 404/500 等通用错误页与路由守卫完善。
- 前端图片加载占位/懒加载策略统一，补充默认占位图。
- Flyway 迁移脚本补齐或显式关闭（若暂不使用）。
- 提炼主题变量与“消防主题”组件库（按钮、徽章、Banner、优惠券卡片）。

---

### 8. 已知问题与风险
- 后端仓库中有多处历史文件被删除（见仓库记录，如 `db/migration/V1__init_schema.sql` 与若干模块下实体/Mapper/Service/Controller 等）。这可能导致：
  - 某些业务功能不可用或运行期抛错（接口 404/500）。
  - Flyway 启动但找不到迁移，或数据结构不完整。
- 前端 Vue SFC 曾多次出现文件被清空、BOM 字符、结构缺失问题。风险：
  - 热更新时出现 “Element is missing end tag” 或 “At least one <template> or <script> is required”。
  - 建议统一以 “UTF-8 无 BOM” 保存，并在 IDE 中开启保存前检测。

---

### 9. 界面与交互规范（简要）
- 设计方向：淘宝风 + 消防主题（主色红/orange 渐变，点缀灰白）
- 商品卡片：5 列（≥1280px），1024px=4 列，≤768px=2 列；卡片图片高 160px（移动端 140px）
- 页头：Logo 居左，搜索居中定宽（约 560px），导航项筹码风，头像 48px 圆形最右
- 页脚：深色主题，最多两行，水平对齐、分隔符，移动端栅格收缩为 1-2 列
- 个人中心：顶部红色渐变 Hero，垂直卡片，进入场动画，表单在小屏下标签换行

---

### 10. 联调与自测建议
- 启动后验证：
  - `GET /actuator/health` 为 `UP`
  - 访问前端首页、商品列表、商品详情、登录、个人中心
- 常见前端异常处理：
  - SFC 报错：检查是否缺失 `<template>` / `<script setup lang="ts">` / `<style scoped>` 三段结构
  - HMR 异常：删除 `frontend/node_modules/.vite` 后重启
  - 动态导入失败：确认路由组件路径是否存在且文件不是空文件
- 常见后端异常处理：
  - “Failed to load driver class com.mysql.cj.jdbc.Driver”：确认 `EF-webapp/pom.xml` 有 `mysql-connector-j`，重新 `mvn clean package`
  - Flyway 导致启动失败：临时禁用或补齐迁移脚本
  - 500 错误：查看 `logs` 与堆栈，核对对应模块是否被删除或实体映射缺失

---

### 11. 运维与监控
- 健康检查：`/actuator/health`
- 指标与日志：Spring Boot Actuator、应用日志（建议接入 ELK/可观测平台）
- 配置管理：本地/测试/生产使用独立 `application-*.yml`，敏感信息放环境变量或密钥管理服务

---

### 12. 交接清单
- 代码与分支：确保提交、推送最新稳定分支
- 构建产物：`EF-webapp` 可运行包或运行方式说明
- 配置文件：不含敏感信息的样例，实际密钥线下交付
- 运行脚本：后端/前端启动与一键脚本（可选）
- 数据库：初始化脚本或 Flyway 迁移脚本（如启用）
- 接口文档：至少涵盖登录、商品列表、商品详情、个人信息相关接口
- 问题单与待办：本文件“待办清单”的细化任务
- 联系方式：后续问题对接人

---

### 13. 附录 A：关键文件
- 后端 POM：`EF-webapp/pom.xml`
- 启动类：`EF-webapp/src/main/java/com/easternfirefighter/EasternFirefighterApplication.java`
- Web 配置：`EF-webapp/src/main/java/com/easternfirefighter/config/WebMvcConfig.java`
- 前端主题：`frontend/src/assets/theme.css`
- 导航栏：`frontend/src/components/NavBar.vue`
- 首页：`frontend/src/views/Home.vue`
- 个人中心：`frontend/src/views/Profile.vue`
- 路由：`frontend/src/router/index.ts`
- 资源：`frontend/public/logo.svg`、`frontend/public/images/avatar-default.svg`

---

### 14. 附录 B：命令速查
```powershell
# 根目录全量安装（跳过测试）
mvn -q -DskipTests clean install

# 仅 EF-webapp 打包与运行
cd EF-webapp
mvn -q -DskipTests clean package
mvn spring-boot:run

# 前端
cd ..\frontend
npm install
npm run dev -- --host
```

---

### 15. 附录 C：接口约定（示意）
- 登录：`POST /api/auth/sms/login`（返回用户信息与 token）— 当前返回 500，需排查后端实现与 DB
- 商品列表：`GET /api/commerce/products?keyword=&page=&size=`
- 商品详情：`GET /api/commerce/products/{id}`
- 用户信息：`GET /api/user/me`

---

### 16. 附录 D：UI 风格要点
- 主色：消防红（如 `#ef3a2d`）到橙色渐变（如 `#ff5f1a`）
- 按钮：主按钮高对比（白字红底），次级按钮边框样式
- 卡片：阴影轻、圆角中等、悬浮提升
- 字体：中文优先清晰、字号分层（标题 > 小标题 > 正文）
- 动效：进入动画轻微（200ms~300ms），避免夸张

---

接下来的目标可选（）：

完成前端代码打包，进行小程序代码转换，具体可看apk打包这个文档，然后购买服务器，账号可找甲方要，也可以用自己的账号，将代码部署到服务器上更好的进行开发，资金问题可找财务报销

商家端和管理端和用户端的分离



注意事项：前端代码建议调整风格，当前风格不是很好





重点完成ai助手的智能推荐和智能推荐导购



由于前段时间代码出现问题，cursor莫名将代码删除，说sfc问题，导致其中的代码整片删除，要谨慎查看修改后的代码

我用了一天时间才恢复完全，不知道还有没有一些隐藏bug，我想是有的



前端是frontend那个文件  你可以分离开在vscode那里运行



由于写这个项目的总时间不多，还是一人开发，所以很多东西都不完善，如果你是一个人开发，你需要尽可能的把前端优化好，这样可以优先展示一些成果给甲方看，即使这个功能还未实现后端




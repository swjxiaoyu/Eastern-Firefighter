# 本地智能体使用指南

## 概述

本项目实现了一个功能完整的本地智能体系统，具备自主操作和主动收集外界信息的能力。智能体可以：

- **自主任务规划**：根据用户目标自动生成执行计划
- **多工具协作**：使用各种工具完成复杂任务
- **记忆管理**：保存和检索历史信息
- **实时监控**：提供任务执行状态和进度
- **Web界面**：直观的管理控制台

## 功能特性

### 1. 核心能力

- **任务管理**：创建、暂停、恢复、监控任务
- **工具系统**：文件操作、网络搜索、系统监控、数据库查询等
- **记忆系统**：短期记忆、长期记忆、语义记忆
- **实时通信**：SSE流式更新任务状态

### 2. 可用工具

| 工具名称 | 功能描述 | 参数 |
|---------|---------|------|
| `web_search` | 网络搜索 | query, maxResults |
| `file_operation` | 文件操作 | operation, path, content |
| `system_info` | 系统信息 | type |
| `database_query` | 数据库查询 | sql, type |
| `save_memory` | 保存记忆 | content, type |
| `network_monitor` | 网络监控 | url, timeout |
| `process_monitor` | 进程监控 | processName |

## 快速开始

### 1. 启动系统

```bash
# 编译所有模块
mvn clean install -DskipTests

# 启动后端服务
cd EF-webapp
mvn spring-boot:run

# 启动前端服务
cd ../frontend
npm install
npm run dev
```

### 2. 访问智能体控制台

打开浏览器访问：`http://localhost:3000/agent`

需要管理员权限才能访问智能体控制台。

## API 接口

### 创建任务

```http
POST /api/agent/tasks
Content-Type: application/json

{
  "goal": "收集最新的消防技术信息",
  "context": {
    "priority": "high",
    "category": "technology"
  }
}
```

### 获取任务状态

```http
GET /api/agent/tasks/{taskId}
```

### 任务状态流

```http
GET /api/agent/tasks/{taskId}/stream
Accept: text/event-stream
```

### 搜索记忆

```http
GET /api/agent/memory/search?query=消防&limit=10
```

## 使用示例

### 示例1：信息收集任务

```javascript
// 创建信息收集任务
const response = await fetch('/api/agent/tasks', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    goal: "搜索并收集最新的消防设备技术信息",
    context: {
      keywords: ["消防设备", "新技术", "2024"],
      sources: ["官方网站", "技术论坛", "新闻"]
    }
  })
});

const result = await response.json();
console.log('任务ID:', result.taskId);
```

### 示例2：文件操作任务

```javascript
// 创建文件操作任务
const response = await fetch('/api/agent/tasks', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    goal: "读取项目配置文件并分析",
    context: {
      path: "./config/application.yml",
      operation: "read"
    }
  })
});
```

### 示例3：系统监控任务

```javascript
// 创建系统监控任务
const response = await fetch('/api/agent/tasks', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    goal: "检查系统资源使用情况",
    context: {
      monitorType: "all",
      alertThreshold: 80
    }
  })
});
```

## 任务状态说明

| 状态 | 描述 |
|------|------|
| `PLANNING` | 任务规划中 |
| `EXECUTING` | 任务执行中 |
| `PAUSED` | 任务已暂停 |
| `COMPLETED` | 任务已完成 |
| `FAILED` | 任务执行失败 |

## 记忆类型说明

| 类型 | 描述 | 用途 |
|------|------|------|
| `SHORT_TERM` | 短期记忆 | 临时信息存储 |
| `LONG_TERM` | 长期记忆 | 持久化信息存储 |
| `EPISODIC` | 情景记忆 | 事件和经历记录 |
| `SEMANTIC` | 语义记忆 | 知识和概念存储 |

## 扩展开发

### 添加新工具

1. 实现 `AgentCore.AgentTool` 接口：

```java
public class CustomTool implements AgentCore.AgentTool {
    @Override
    public String getName() {
        return "custom_tool";
    }
    
    @Override
    public String getDescription() {
        return "自定义工具描述";
    }
    
    @Override
    public Map<String, Object> getParameters() {
        Map<String, Object> params = new HashMap<>();
        params.put("param1", "参数1描述");
        return params;
    }
    
    @Override
    public CompletableFuture<String> execute(Map<String, Object> parameters) {
        return CompletableFuture.supplyAsync(() -> {
            // 实现工具逻辑
            return "执行结果";
        });
    }
}
```

2. 在 `AgentTools` 中注册工具：

```java
agentCore.registerTool(new CustomTool());
```

### 自定义任务规划

修改 `AgentCore.generateActionPlan()` 方法，根据不同的目标类型生成相应的执行计划。

### 添加新的记忆类型

在 `AgentCore.AgentMemory.MemoryType` 枚举中添加新的记忆类型。

## 配置说明

### 应用配置

在 `application.yml` 中配置智能体相关参数：

```yaml
agent:
  core:
    max-concurrent-tasks: 10
    task-timeout: 300  # 秒
  memory:
    max-memories: 1000
    cleanup-interval: 3600  # 秒
  tools:
    web-search:
      max-results: 10
      timeout: 30
    file-operation:
      max-file-size: 10485760  # 10MB
```

## 故障排除

### 常见问题

1. **任务创建失败**
   - 检查目标描述是否清晰
   - 确认上下文参数格式正确

2. **工具执行失败**
   - 检查工具参数是否正确
   - 确认系统权限是否足够

3. **记忆搜索无结果**
   - 尝试不同的搜索关键词
   - 检查记忆是否已保存

### 日志查看

智能体相关日志会输出到应用日志中，可以通过以下方式查看：

```bash
# 查看实时日志
tail -f logs/application.log | grep "Agent"

# 查看错误日志
grep "ERROR.*Agent" logs/application.log
```

## 性能优化

1. **并发控制**：合理设置最大并发任务数
2. **内存管理**：定期清理过期记忆
3. **工具优化**：缓存常用工具的执行结果
4. **网络优化**：设置合适的超时时间

## 安全考虑

1. **权限控制**：只有管理员可以访问智能体控制台
2. **文件操作**：限制文件操作的路径范围
3. **网络请求**：限制可访问的URL范围
4. **数据保护**：敏感信息不保存到记忆中

## 未来规划

- [ ] 添加更多工具（邮件发送、API调用等）
- [ ] 实现任务依赖和条件执行
- [ ] 添加任务模板和预设
- [ ] 支持多智能体协作
- [ ] 集成外部AI服务
- [ ] 添加任务调度和定时执行

